## 034 –û–±–∑–æ—Ä –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

–ù–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –≤ –∫–æ–Ω—Å–æ–ª–∏ –∏ –≤—ã–≤–æ–¥–∏—Ç—å –ø–æ–≥–æ–¥—É –ø–æ –∑–∞–ø—Ä–æ—Å—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

![](_png/ceb1b56b20de5ec3d94bc8e8d27a525d.png)

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –±—É–¥–µ—Ç —Å—Ç–∏–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–º, –ø–æ–ª—É—á–∞—Ç—å –∞—Ä–≥—É–º–µ–Ω—Ç—ã –∏ —Ä–∞–±–æ—Ç–∞—Ç—å —Å–æ —Å—Ç–æ—Ä–æ–Ω–Ω–∏–º API

![](_png/f62b645f8f359b9b642a6a3cf70865a9.png)

###### –ü–æ–ª—É—á–∞—Ç—å –ø–æ–≥–æ–¥—É –±—É–¥–µ–º [–æ—Ç—Å—é–¥–∞](https://openweathermap.org/)

## 035 –ê—Ä–≥—É–º–µ–Ω—Ç—ã –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏

–ü–æ–º–µ–Ω—è–µ–º —Ç–æ—á–∫—É –≤—Ö–æ–¥–∞ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏ –¥–æ–±–∞–≤–∏–º –±–∏–Ω–∞—Ä–Ω–∏–∫, —á—Ç–æ–±—ã –ø—Ä–∏ –≥–ª–æ–±–∞–ª—å–Ω–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫–µ –Ω–∞—à–µ–≥–æ –º–æ–¥—É–ª—è, –º–æ–∂–Ω–æ –±—ã–ª–æ –µ–≥–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å –∏ –≤–æ—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –∏–º. –¢–∞–∫ –∂–µ –∏–º–ø–æ—Ä—Ç—ã –±—É–¥–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ –≤–∏–¥–µ –º–æ–¥—É–ª–µ–π, –∞ –Ω–µ –∫–æ–º–º–æ–Ω–∞

```JSON
"main": "weather.js",
"bin": {
	"weather": "weather.js"
},
"type": "module",
```

–≠—Ç—É —Å—Ç—Ä–æ—á–∫—É —É–∫–∞–∂–µ–º –≤ —Ñ–∞–π–ª–µ –≤—Ö–æ–¥–∞ –≤ –Ω–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ, —á—Ç–æ–±—ã —É–∫–∞–∑–∞—Ç—å —Å–∏—Å—Ç–µ–º–µ –∫–∞–∫ –∑–∞–ø—É—Å–∫–∞—Ç—å —ç—Ç–æ—Ç —Ñ–∞–π–ª

```JS
#!/usr/bin/env node
```

–û–±—ä–µ–∫—Ç `process.argv` —Ö—Ä–∞–Ω–∏—Ç –∞—Ä–≥—É–º–µ–Ω—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ –º—ã –ø–µ—Ä–µ–¥–∞–ª–∏ –Ω–∞ –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç –≤ –∫–æ–Ω—Å–æ–ª—å

```JS
#!/usr/bin/env node

const initCLI = () => {
	console.log(process.argv);
};

initCLI();
```

–ò —Ç—É—Ç –º—ã –º–æ–∂–µ–º —É–≤–∏–¥–µ—Ç—å –≤—Å–µ –∞—Ä–≥—É–º–µ–Ω—Ç—ã, —á—Ç–æ –Ω–∞–ø–∏—à–µ–º –≤ –∫–æ–Ω—Å–æ–ª—å

![](_png/09ebe9cbd790b495bce561e837109b77.png)

![](_png/517432efb15b05ea37eaa70f9880158c.png)

–ù—É –∏ –¥–∞–ª–µ–µ –æ–ø–∏—à–µ–º –ª–æ–≥–∏–∫—É —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –ø–æ–ª—É—á–µ–Ω–∏—è

`helpers > args.js`

```JS
// —ç—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è –±—É–¥–µ—Ç –ø–æ–ª—É—á–∞—Ç—å –∞—Ä–≥—É–º–µ–Ω—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ –º—ã –ø–µ—Ä–µ–¥–∞–ª–∏ –≤ —Å–∫—Ä–∏–ø—Ç —Ç–µ—Ä–º–∏–Ω–∞–ª–∞
const getArgs = (args) => {
	// —ç—Ç–æ—Ç –æ–±—ä–µ–∫—Ç –±—É–¥–µ—Ç —Ö—Ä–∞–Ω–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Å —Ñ–ª–∞–≥–∞–º–∏
	const res = {};
	// —Ç—É—Ç –º—ã —Ä–∞—Å–∫–ª–∞–¥—ã–≤–∞–µ–º –Ω–∞—à –º–∞—Å—Å–∏–≤
	// –ø–µ—Ä–≤—ã–µ –¥–≤–∞ –∑–Ω–∞—á–µ–Ω–∏—è - —ç—Ç–æ –≤—ã–∑—ã–≤–∞—Ç–µ–ª—å –∏ –≤—ã–∑—ã–≤–∞–µ–º—ã–π —Ñ–∞–π–ª
	// –≤—Å—ë –æ—Å—Ç–∞–ª—å–Ω–æ–µ (rest) - —ç—Ç–æ –ø–µ—Ä–µ–¥–∞–Ω–Ω—ã–µ –∞—Ä–≥—É–º–µ–Ω—Ç—ã
	const [executer, file, ...rest] = args;

	// –æ—Ç–¥–µ–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ, –∏–Ω–¥–µ–∫—Å, –∏—Å—Ö–æ–¥–Ω—ã–π –º–∞—Å—Å–∏–≤
	rest.forEach((value, i, array) => {
		// –µ—Å–ª–∏ –ø–µ—Ä–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ —ç—Ç–æ "-", —Ç–æ ...
		if (value.charAt(0) == "-") {
			// –µ—Å–ª–∏ –º—ã –¥–æ—à–ª–∏ –¥–æ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞ (–ø–æ—Å–ª–µ –¥–µ—Ñ–∏—Å–∞ –Ω–∏—á–µ–≥–æ –Ω–µ—Ç)
			if (i == array.length - 1) {
				// —Ç–æ –ø–æ –∫–ª—é—á—É —ç—Ç–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è –ø—Ä–æ—Å—Ç–æ –ø–æ—Å—Ç–∞–≤–∏–º true
				res[value.substring(1)] = true;

				// ... –æ–¥–Ω–∞–∫–æ –µ—Å–ª–∏ –≤—Ç–æ—Ä–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ —É–∂–µ –∫–∞–∫–∞—è-—Ç–æ –±—É–∫–≤–∞, –∞ –Ω–µ "-" –∏–ª–∏ –ø—É—Å—Ç–æ—Ç–∞, —Ç–æ ...
			} else if (array[i + 1].charAt(0) != "-") {
				// –∫–ª—é—á –≤ res —Å–æ–∑–¥–∞—ë–º –±–µ–∑ –ø–µ—Ä–≤–æ–≥–æ –º–∏–Ω—É—Å–∞ –≤ –∑–Ω–∞—á–µ–Ω–∏–∏ (–æ—Ç–∫–∏–¥—ã–≤–∞–µ–º "-") –∏ –¥–æ–±–∞–≤–ª—è–µ–º —Å–ª–µ–¥—É—é—â–∏–π –∞—Ä–≥—É–º–µ–Ω—Ç –≤ –∫–∞—á–µ—Å—Ç–≤–µ –∑–Ω–∞—á–µ–Ω–∏—è —Ñ–ª–∞–≥–∞
				res[value.substring(1)] = array[i + 1];

				// ... –æ–¥–Ω–∞–∫–æ, –µ—Å–ª–∏ —É –Ω–∞—Å –µ—Å—Ç—å –≤—Ç–æ—Ä–æ–π —ç–ª–µ–º–µ–Ω—Ç, —Å–æ–¥–µ—Ä–∂–∞—â–∏–π "-", —Ç–æ ...
			} else {
				res[value.substring(1)] = true;
			}
		}
	});

	return res;
};

export { getArgs };
```

–ò —Ç—É—Ç –≤—ã–≤–µ–¥–µ–º –≤ –∫–∞—á–µ—Å—Ç–≤–µ –æ–±—ä–µ–∫—Ç–∞ –Ω–∞—à–∏ –ø–æ–ª—É—á–µ–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –∫–ª—é—á–µ–π

`weather.js`

```JS
#!/usr/bin/env node
import { getArgs } from "./helpers/args.js";

const initCLI = () => {
	const args = getArgs(process.argv);
	console.log(args);

	if (args.h) {
		// –≤—ã–≤–æ–¥ help
	}

	if (args.s) {
		// —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≥–æ—Ä–æ–¥
	}

	if (args.t) {
		// —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç–æ–∫–µ–Ω
	}

	// –í—ã–≤–µ—Å—Ç–∏ –ø–æ–≥–æ–¥—É
};

initCLI();
```

–ú–æ–∂–Ω–æ —É–≤–∏–¥–µ—Ç—å, —á—Ç–æ –Ω–∞—à–∏–º –∫–ª—é—á–∞–º –ø—Ä–∏—Å–≤–∞–∏–≤–∞–µ—Ç—Å—è –∑–Ω–∞—á–µ–Ω–∏–µ, –µ—Å–ª–∏ –º—ã –µ–≥–æ –ø–µ—Ä–µ–¥–∞–ª–∏ —Å–ª–µ–¥—É—é—â–∏–º –∞—Ä–≥—É–º–µ–Ω—Ç–æ–º

![](_png/3ace24b5bad920b54157e2f88cda50c4.png)

## 036 –í—ã–≤–æ–¥ –≤ –∫–æ–Ω—Å–æ–ª—å

–î–∞–ª—å—à–µ –º—ã —Å–æ–∑–¥–∞–¥–∏–º —Å–µ—Ä–≤–∏—Å, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç —Ä–µ–∞–ª–∏–∑–æ–≤—ã–≤–∞—Ç—å —Ä–∞–∑–ª–∏—á–Ω—ã–µ –≤—ã–≤–æ–¥—ã –≤ –∫–æ–Ω—Å–æ–ª—å

–î–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã –ø–æ–∫—Ä–∞—Å–∏—Ç—å —Ç–µ–∫—Å—Ç –≤ —Ä–∞–∑–Ω—ã–µ —Ü–≤–µ—Ç–∞, –Ω—É–∂–Ω–æ –±—É–¥–µ—Ç –≤–æ—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –º–æ–¥—É–ª–µ–º `chalk`, –≤ –∫–æ—Ç–æ—Ä–æ–º –µ—Å—Ç—å –∫—Ä–∞—Å–∏–≤—ã–µ —Ä–∞—Å–∫—Ä–∞—Å–∫–∏ –Ω–∞—à–µ–≥–æ —Ç–µ–∫—Å—Ç–∞ –≤ –∫–æ–Ω—Å–æ–ª–∏

`services > log.service.js`

```JS
import chalk from "chalk";
import dedent from "dedent-js";

// –≤—ã–≤–æ–¥–∏–º –æ—à–∏–±–∫—É
const printError = (error) => {
	console.log(`${chalk.bgRed(" ERROR")} ${error}`);
};

// –≤—ã–≤–æ–¥–∏–º –æ–ø–æ–≤–µ—â–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—à–Ω–æ–º –∑–∞–ø—Ä–æ—Å–µ
const printSuccess = (success) => {
	console.log(`${chalk.bgGreen(" Success")} ${success}`);
};

// –≤—ã–≤–æ–¥–∏–º –ø–æ–º–æ—â—å –Ω–∞—à–µ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
const printHelp = () => {
	console.log(
		dedent`
			${chalk.bgCyan(" HELP ")}
			–ë–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ - –≤—ã–≤–æ–¥ –ø–æ–≥–æ–¥—ã
			-s [CITY] –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –≥–æ—Ä–æ–¥–∞
			-t [API_KEY] –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —Ç–æ–∫–µ–Ω–∞
			-h –¥–ª—è –ø–æ–∫–∞–∑–∞ –ø–æ–º–æ—â–∏
		`
	);
};

export { printError, printSuccess, printHelp };
```

–¢—É—Ç –º—ã –±—É–¥–µ–º –≤—ã–∑—ã–≤–∞—Ç—å —Å–∞–º–∏ –Ω–∞—à–∏ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –≤—ã–≤–æ–¥–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏

`weather.js`

```JS
#!/usr/bin/env node
import { getArgs } from "./helpers/args.js";
import { printHelp, printError, printSuccess } from "./services/log.service.js";

const initCLI = () => {
	const args = getArgs(process.argv);

	if (args.h) {
		printHelp();
	}

	if (args.s) {
		// —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≥–æ—Ä–æ–¥
	}

	if (args.t) {
		// —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç–æ–∫–µ–Ω
	}

	// –í—ã–≤–µ—Å—Ç–∏ –ø–æ–≥–æ–¥—É
};

initCLI();
```

–ò —Ç—É—Ç –º–æ–∂–Ω–æ –≤—Å—Ç—Ä–µ—Ç–∏—Ç—å—Å—è —Å —Ç–∞–∫–æ–π –ø—Ä–æ–±–ª–µ–º–æ–π, —á—Ç–æ —É –Ω–∞—Å —Ç–µ–∫—Å—Ç –ø–µ—Ä–µ–Ω–∏–º–∞–µ—Ç —Ç–µ –∂–µ –æ—Ç—Å—Ç—É–ø—ã, —á—Ç–æ –∏ –≤ –∫–æ–¥–µ. –ò—Ö –º–æ–∂–Ω–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å, —É–±—Ä–∞–≤ –æ—Ç—Å—Ç—É–ø—ã –≤ –∫–æ–¥–µ, –Ω–æ –º–æ–∂–Ω–æ –∏—Ö —É–±—Ä–∞—Ç—å —á–µ—Ä–µ–∑ –æ—Ç–¥–µ–ª—å–Ω—ã–π –º–æ–¥—É–ª—å `dedent-js`

![](_png/5e7830fc408fdfe4558b59714c9fc326.png)
![](_png/11c4492780eb60e368b02a118ad8bdd7.png)

–û—Ç–¥–µ–ª—å–Ω–æ —Ö–æ—á–µ—Ç—Å—è —Ä–∞—Å—Å–∫–∞–∑–∞—Ç—å –ø—Ä–æ –∫—Ä–∞—Ç–∫—É—é –∑–∞–ø–∏—Å—å –ø–µ—Ä–µ–¥–∞—á–∏ —Å—Ç—Ä–æ–∫–∏ –≤–Ω—É—Ç—Ä—å —Ñ—É–Ω–∫—Ü–∏–∏. –ö–æ–Ω–∫—Ä–µ—Ç–Ω–æ —Ç—É—Ç –º—ã –Ω–µ –æ–±–æ—Ä–∞—á–∏–≤–∞–ª–∏ —Å—Ç—Ä–æ–∫—É –≤ `()`. –¢—É—Ç –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–æ—Å—Ç–æ –Ω–∞–ø–∏—Å–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é –∏ —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –≤ –∫–∞–≤—ã—á–∫–∞—Ö —Å—Ç—Ä–æ–∫—É, —á—Ç–æ–±—ã –ø–µ—Ä–µ–¥–∞—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ –≤–Ω—É—Ç—Ä—å –Ω–µ—ë:

```JS
dedent`—Å—Ç—Ä–æ–∫–∞`
```

```JS
console.log(
		dedent`
			${chalk.bgCyan(" HELP ")}
			–ë–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ - –≤—ã–≤–æ–¥ –ø–æ–≥–æ–¥—ã
			-s [CITY] –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –≥–æ—Ä–æ–¥–∞
			-t [API_KEY] –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —Ç–æ–∫–µ–Ω–∞
			-h –¥–ª—è –ø–æ–∫–∞–∑–∞ –ø–æ–º–æ—â–∏
		`
	);
```

![](_png/a63f76c471998de5a802ba88dae62b3b.png)

## 037 OS –∏ path

–î–∞–ª–µ–µ –º—ã –º–æ–∂–µ–º –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å—Å—è –∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ –∑–∞–ø–∏—Å–∏ –¥–∞–Ω–Ω—ã—Ö –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ, –∫–æ—Ç–æ—Ä–æ–µ –±—É–¥–µ—Ç –Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –≤ –¥–æ–º–∞—à–Ω–µ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –ü–ö

`weather.js`

```JS
#!/usr/bin/env node
import { getArgs } from "./helpers/args.js";
import { printHelp, printError, printSuccess } from "./services/log.service.js";
import { saveKeyValue } from "./services/storage.service.js";

const initCLI = () => {
	const args = getArgs(process.argv);

	if (args.h) {
		printHelp();
	}

	if (args.s) {
		// —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≥–æ—Ä–æ–¥
	}

	if (args.t) {
		saveKeyValue("token", args.t);
	}

	// –í—ã–≤–µ—Å—Ç–∏ –ø–æ–≥–æ–¥—É
};

initCLI();
```

–¢—É—Ç –º—ã –ø–æ–ª—É—á–∞–µ–º –¥–æ—Å—Ç—É–ø –∫ –¥–æ–º–∞—à–Ω–µ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –Ω–∞—à–µ–π –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã

`services > storage.service.js`

```JS
// os - —ç—Ç–æ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º–æ–π
// homedir - –≤—ã–≤–µ–¥–µ—Ç –¥–æ–º–∞—à–Ω—é—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é (—É—á–∏—Ç—ã–≤–∞—è –û–°)
import { homedir } from "os";
// path - —ç—Ç–æ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø—É—Ç—è–º–∏
// join - –ø–æ–∑–≤–æ–ª—è–µ—Ç –∏–∑ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ —Å—Ç—Ä–æ–∏—Ç—å –ü–†–ê–í–ò–õ–¨–ù–´–ô –ø—É—Ç—å
import { join } from "path";

const filePath = join(homedir(), "weather-data.json");

const saveKeyValue = (key, value) => {
};

export { saveKeyValue };
```

–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ `path`:

- `join()` -
- `basename()` - –≤—ã–≤–µ–¥–µ—Ç –≤–ª–æ–∂–µ–Ω–∏–µ –ø–æ—Å–ª–µ–¥–Ω–µ–π –ø–∞–ø–∫–∏
- `dirname()` - –ø–æ–∫–∞–∂–µ—Ç, –≥–¥–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è —É–∫–∞–∑–∞–Ω–Ω—ã–π –≤ —Å—Ç—Ä–æ–∫–µ –ø—É—Ç—å
- `extname()` - –ø–æ–ª—É—á–∞–µ–º —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ñ–∞–π–ª–∞
- `relative()` - –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—É—Ç—å –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –¥–≤—É—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ (—á—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å, —á—Ç–æ–±—ã –ø—Ä–∏–π—Ç–∏ –æ—Ç –ø–µ—Ä–≤–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞ –∫–æ –≤—Ç–æ—Ä–æ–º—É)
- `isAbsolute()` - –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, –∞–±—Å–æ–ª—é—Ç–Ω—ã–π –ª–∏ –ø—É—Ç—å
- `resolve()` - –ø–æ–∫–∞–∂–µ—Ç –ø—É—Ç—å, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç, –µ—Å–ª–∏ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–µ —à–∞–≥–∏ (–æ—Ç—Ö–æ–¥–∏—Ç –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ —Ç–µ–∫—É—â–µ–π –ø–∞–ø–∫–∏)
- `sep` - –ø–æ–∫–∞–∂–µ—Ç, –∫–∞–∫–æ–π —Å–µ–ø–∞—Ä–∞—Ç–æ—Ä –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –Ω–∞—à–µ–π –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º–µ (`/` –∏–ª–∏ `\`)

![](_png/5524c52fe39fd5d3cf03d30c3df6ce43.png)
![](_png/f3f68a01f0145628ca380ce76ccfbb7e.png)

## 038 –†–∞–±–æ—Ç–∞ —Å —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–æ–π

–î–æ–ø–æ–ª–Ω–∏–º –Ω–∞—à —Å–µ—Ä–≤–∏—Å –ø–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—é –¥–∞–Ω–Ω—ã—Ö. –ö–æ–Ω–∫—Ä–µ—Ç–Ω–æ —Ç—É—Ç –Ω—É–∂–Ω–æ –±—ã–ª–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å:

- —Å–æ–∑–¥–∞–Ω–∏–µ —Ñ–∞–π–ª–∞,
- –ø—Ä–æ–≤–µ—Ä–∫—É –µ–≥–æ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è,
- —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –µ–≥–æ –¥–∞–Ω–Ω—ã—Ö –≤ –ø–∞–º—è—Ç—å, –µ—Å–ª–∏ —Ñ–∞–π–ª —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, —á—Ç–æ–±—ã –≤ –±—É–¥—É—â–µ–º –ø–µ—Ä–µ–ø–∏—Å–∞—Ç—å –µ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è

–ù—É–∂–Ω–æ –æ—Ç–º–µ—Ç–∏—Ç—å, —á—Ç–æ —Ç—É—Ç –º—ã –Ω–µ –ø–æ–ª—å–∑–æ–≤–∞–ª–∏—Å—å –±–∏–±–ª–∏–æ—Ç–µ–∫–æ–π `writeFile` –∏–ª–∏ `writeFileSync`. –í–º–µ—Å—Ç–æ –Ω–∏—Ö –º—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ `promises`, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —Ç–æ—Ç –∂–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª, –Ω–æ –≤ –≤–∏–¥–µ –ø—Ä–æ–º–∏—Å–æ–≤.

`services > storage.service.js`

```JS
// os - —ç—Ç–æ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º–æ–π
// homedir - –≤—ã–≤–µ–¥–µ—Ç –¥–æ–º–∞—à–Ω—é—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é (—É—á–∏—Ç—ã–≤–∞—è –û–°)
import { homedir } from "os";
// path - —ç—Ç–æ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø—É—Ç—è–º–∏
// join - –ø–æ–∑–≤–æ–ª—è–µ—Ç –∏–∑ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ —Å—Ç—Ä–æ–∏—Ç—å –ü–†–ê–í–ò–õ–¨–ù–´–ô –ø—É—Ç—å
import { join } from "path";
// fs - —ç—Ç–æ –º–æ–¥—É–ª—å –ø–æ —Ä–∞–±–æ—Ç–µ —Å —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–æ–π –Ω–∞—à–µ–≥–æ –ü–ö
import { promises } from "fs";

// —Å–æ–∑–¥–∞—ë–º –ø—É—Ç—å –¥–æ –Ω–∞—à–µ–≥–æ —Ñ–∞–π–ª–∞, –≤ –∫–æ—Ç–æ—Ä—ã–π –º—ã –±—É–¥–µ–º —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –¥–∞–Ω–Ω—ã–µ
const filePath = join(homedir(), "weather-data.json");

// —ç—Ç–æ —Ñ—É–Ω–∫—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–∞—à–∏—Ö –¥–∞–Ω–Ω—ã—Ö –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º —Ñ–∞–π–ª–µ
const saveKeyValue = async (key, value) => {
	// —ç—Ç–æ –Ω–∞—à–∏ –¥–∞–Ω–Ω—ã–µ –∏–∑ —Ñ–∞–π–ª–∞, –ø–æ—ç—Ç–æ–º—É –æ–Ω–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∏–∑–º–µ–Ω—è–µ–º—ã–º–∏ (let)
	let data = {};

	// –µ—Å–ª–∏ —Ñ–∞–π–ª –ø–æ –¥–∞–Ω–Ω–æ–º—É –ø—É—Ç–∏ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, —Ç–æ –º—ã –º–æ–∂–µ–º —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –µ–≥–æ –¥–∞–Ω–Ω—ã–µ –≤ –û–ó–£
	if (await isExist(filePath)) {
		const file = await promises.readFile(filePath);
		data = JSON.parse(file);
	}

	// –î–∞–ª–µ–µ –∑–∞–Ω–µ—Å—Ç–∏ –Ω–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ data
	data[key] = value;

	// –∏ —Ç–µ–ø–µ—Ä—å –º—ã –º–æ–∂–µ–º –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∞—Ç—å –Ω–∞—à —Ñ–∞–π–ª
	await promises.writeFile(filePath, JSON.stringify(data));
};

// –¥–∞–ª–µ–µ –º—ã –ø–æ–ª—É—á–∞–µ–º –∫–ª—é—á –Ω–∞—à–µ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è
const getKeyValue = async (key) => {
	if (await isExist(filePath)) {
		const file = await promises.readFile(filePath);
		const data = JSON.parse(file);
		// –≤–µ—Ä–Ω—ë—Ç –∫–ª—é—á –¥–∞–Ω–Ω—ã—Ö, –µ—Å–ª–∏ –æ–Ω–∏ —Å—É—â–µ—Å—Ç–≤—É—é—Ç
		return data[key];
	}
	// –∏ –Ω–∏—á–µ–≥–æ –Ω–µ –≤–µ—Ä–Ω—ë—Ç, –µ—Å–ª–∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–µ –ø—Ä–æ—à–ª–∞
	return undefined;
};

// –≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∏—Ç, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ –¥–∞–Ω–Ω—ã–π —Ñ–∞–π–ª
const isExist = async (path) => {
	try {
		// stat –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ —Ñ–∞–π–ª—É, –Ω–æ –µ—Å–ª–∏ —Ñ–∞–π–ª–∞ –Ω–µ—Ç, —Ç–æ –æ–Ω –ø–∞–¥–∞–µ—Ç
		await promises.stat(path);
		// –¥–∞, —Ç–∞–∫ –∫–∞–∫ –æ–Ω —Å–º–æ–≥ –≤–µ—Ä–Ω—É—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
		return true;
	} catch (e) {
		// –∏ –Ω–µ—Ç, —Ç–∞–∫ –∫–∞–∫ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –Ω–µ –≤–µ—Ä–Ω—É–ª –∏ —Ñ—É–Ω–∫—Ü–∏—è —É–ø–∞–ª–∞
		return false;
	}
};

export { saveKeyValue, getKeyValue };
```

–¢—É—Ç –∂–µ –º—ã —Å–¥–µ–ª–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É –Ω–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ –∏ —Ç–∞–∫ –∂–µ –æ–ø–æ–≤–µ—Å—Ç–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –æ —Å—Ç–∞—Ç—É—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏

`weather.js`

```JS
#!/usr/bin/env node
import { getArgs } from "./helpers/args.js";
import { printHelp, printError, printSuccess } from "./services/log.service.js";
import { saveKeyValue } from "./services/storage.service.js";

// —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –æ–ø–µ—Ä–∞—Ü–∏–∏
const saveToken = async (token) => {
	// –ø—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —Ç–æ–∫–µ–Ω–∞
	if (!token.length) {
		printError("–ù–µ –ø–µ—Ä–µ–¥–∞–Ω —Ç–æ–∫–µ–Ω");
		return;
	}

	// —Å–∞–º–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
	try {
		await saveKeyValue("token", token);
		printSuccess("–¢–æ–∫–µ–Ω —Å–æ—Ö—Ä–∞–Ω—ë–Ω");
	} catch (e) {
		printError("–¢–æ–∫–µ–Ω –Ω–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å :( " + e.message);
	}
};

const initCLI = () => {
	const args = getArgs(process.argv);

	if (args.h) {
		printHelp();
	}

	if (args.s) {
		// —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≥–æ—Ä–æ–¥
	}

	if (args.t) {
		return saveToken(args.t);
	}

	// –í—ã–≤–µ—Å—Ç–∏ –ø–æ–≥–æ–¥—É
};

initCLI();
```

–ö–∞–∫ –∏—Ç–æ–≥, –º—ã –∏–º–µ–µ–º —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –Ω–∞–º–∏ —Ñ–∞–π–ª —Å —Ç–æ–∫–µ–Ω–æ–º

![](_png/d217a6616659dd685d25d4bf6f2be260.png)

## 039 –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å API

–ü–µ—Ä–≤—ã–º –¥–µ–ª–æ–º, –ø–æ—Å–ª–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏, –Ω—É–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å —Ç–æ–∫–µ–Ω

![](_png/952991c0f1ab884f53daaef3bc62517a.png)

–ó–∞—Ç–µ–º –Ω–∞–º —ç—Ç–æ—Ç —Ç–æ–∫–µ–Ω –Ω—É–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ –ø—Ä–æ–≥—Ä–∞–º–º–µ

![](_png/93c6ac21d61a0f1a668068ff33e4dab2.png)

–î–∞–ª—å—à–µ, —á—Ç–æ–±—ã —Ä–µ–∞–ª–∏–∑–æ–≤—ã–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã –Ω–∞ –Ω–∞—à —Å–µ—Ä–≤–µ—Ä –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö, –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–π—Ç–∏ –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –ø–æ –ø–æ–ª—É—á–µ–Ω–∏—é –∑–∞–ø—Ä–æ—Å–æ–≤

![](_png/0c587899c2ceedebc0f355c82ec1bca7.png)

–¢–∞–∫ –∂–µ –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ (—á—Ç–æ–±—ã –º—ã –Ω–µ –¥–æ–ø—É—Å—Ç–∏–ª–∏ –æ—à–∏–±–æ–∫ –ø—Ä–∏ –≤–≤–æ–¥–µ –∏–º–µ–Ω–∏ –∫–ª—é—á–∞), –Ω—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å —Å–ª–æ–≤–∞—Ä—å, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç —Ö—Ä–∞–Ω–∏—Ç—å –∫–ª—é—á–∏ –Ω–∞—à–∏—Ö –∑–Ω–∞—á–µ–Ω–∏–π –≤ —Ñ–∞–π–ª–µ

`storage.service.js`

```JS
// —Ç—É—Ç –º—ã —Å–æ–∑–¥–∞—ë–º —Å–ª–æ–≤–∞—Ä—å, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç —Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞–∑–≤–∞–Ω–∏—è –Ω–∞—à–∏—Ö –∫–ª—é—á–µ–π –≤ —Ñ–∞–π–ª–µ storage
const TOKEN_DICTIONARY = {
	token: "token",
	city: "city",
};

export { saveKeyValue, getKeyValue, TOKEN_DICTIONARY };
```

–ò –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤–º–µ—Å—Ç–æ —Ç–µ–∫—Å—Ç–∞ `"token"` –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ

`weather.js`

```JS
#!/usr/bin/env node
import { getArgs } from "./helpers/args.js";
import { getWeather } from "./services/api.service.js";
import { printHelp, printError, printSuccess } from "./services/log.service.js";
import { saveKeyValue, TOKEN_DICTIONARY } from "./services/storage.service.js";

// —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –æ–ø–µ—Ä–∞—Ü–∏–∏
const saveToken = async (token) => {
	// –ø—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —Ç–æ–∫–µ–Ω–∞
	if (!token.length) {
		printError("–ù–µ –ø–µ—Ä–µ–¥–∞–Ω —Ç–æ–∫–µ–Ω");
		return;
	}

	// —Å–∞–º–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
	try {
		await saveKeyValue(TOKEN_DICTIONARY.token, token);
		printSuccess("–¢–æ–∫–µ–Ω —Å–æ—Ö—Ä–∞–Ω—ë–Ω");
	} catch (e) {
		printError("–¢–æ–∫–µ–Ω –Ω–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å :( " + e.message);
	}
};
```

–°–Ω–∞—á–∞–ª–∞ –ø–æ–ø—Ä–æ–±—É–µ–º —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –¥–µ—Ñ–æ–ª—Ç–Ω—ã–π –≤—ã–∑–æ–≤ –ø–æ–≥–æ–¥—ã –±–µ–∑ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `axios` –æ–±—ã—á–Ω—ã–º –∑–∞–ø—Ä–æ—Å–æ–º –Ω–∞ —É–¥–∞–ª—ë–Ω–Ω—ã–π —Å–µ—Ä–≤–µ—Ä —á–µ—Ä–µ–∑ –º–æ–¥—É–ª—å `https`

`api.service.js`

```JS
// –ø–æ–¥–∫–ª—é—á–∞–µ–º –º–æ–¥—É–ª—å –ø–æ —Ä–∞–±–æ—Ç–µ —Å —Å—Å—ã–ª–∫–∞–º–∏
import https from "https";
import { getKeyValue, TOKEN_DICTIONARY } from "./storage.service.js";

const getWeather = async (city) => {
	return new Promise(async (resolve, reject) => {
		// –ø–æ–ª—É—á–∞–µ–º –∏–∑ –Ω–∞—à–µ–≥–æ —Å–ª–æ–≤–∞—Ä—è —Ç–æ–∫–µ–Ω
		const token = await getKeyValue(TOKEN_DICTIONARY.token);
		if (!token) {
			throw new Error(
				"–¢–æ–∫–µ–Ω –Ω–µ –∑–∞–¥–∞–Ω! –ó–∞–¥–∞–π—Ç–µ –µ–≥–æ —á–µ—Ä–µ–∑ –∫–æ–º–∞–Ω–¥—É -t [API_KEY]"
			);
		}

		// –≤–º–µ—Å—Ç–æ —Ç–æ–≥–æ, —á—Ç–æ–±—ã –∫–æ–Ω—Å—Ç—Ä—É–∏—Ä–æ–≤–∞—Ç—å –Ω–∞—à—É —Å—Å—ã–ª–∫—É —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ
		// const url = `https://api.openweathermap.org/data/2.5/weather?q=${city}&appid=${key}`;
		// –º–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å —Å—Å—ã–ª–∫—É —á–µ—Ä–µ–∑ –∏–Ω—Å—Ç–∞–Ω—Å URL –∏ –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –µ—ë
		const url = new URL("https://api.openweathermap.org/data/2.5/weather");
		// –¥–æ–±–∞–≤–∏–º –≥–æ—Ä–æ–¥
		url.searchParams.append("q", city);
		// –¥–æ–±–∞–≤–∏–º —Ç–æ–∫–µ–Ω
		url.searchParams.append("appid", token);
		// —è–∑—ã–∫ –≤—ã–¥–∞—á–∏ - —Ä—É—Å—Å–∫–∏–π
		url.searchParams.append("lang", "ru");
		// –µ–¥–∏–Ω–∏—Ü—ã –∏–∑–º–µ—Ä–µ–Ω–∏—è - –º–µ—Ç—Ä–∏—á–µ—Å–∫–∏–µ
		url.searchParams.append("units", "metrics");

		// –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –æ –ø–æ–ª—É—á–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö —Å —Å–µ—Ä–≤–µ—Ä–∞
		https.get(url, (response) => {
			let res = ""; // –∑–∞–≥–æ—Ç–æ–≤–∫–∞ –ø–æ–¥ —Ä–µ–∑—É–ª—å—Ç–∞—Ç

			// –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –∫—É—Å–∫–∞ –¥–∞–Ω–Ω—ã—Ö (chunk)
			response.on("data", (chunk) => {
				// –º—ã –±—É–¥–µ–º –¥–æ–±–∞–≤–ª—è—Ç—å —ç—Ç–∏ –¥–∞–Ω–Ω—ã–µ –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç
				res += chunk;
			});

			// –∫–æ–≥–¥–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∑–∞–∫–æ–Ω—á–∏—Ç—Å—è, –º–æ–∂–Ω–æ –±—É–¥–µ—Ç –≤—ã–≤–µ—Å—Ç–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç
			response.on("end", () => {
				resolve(console.log(res));
			});

			// –¥–∞–ª–µ–µ –º—ã –ø–æ–¥–ø–∏—Å—ã–≤–∞–µ–º—Å—è –Ω–∞ –æ—à–∏–±–∫—É, –µ—Å–ª–∏ —Ç–∞–∫–æ–≤–∞—è –±—É–¥–µ—Ç
			response.on("error", (err) => {
				reject(err);
			});
		});
	});
};

export { getWeather };
```

–¢—É—Ç –º—ã –≤—ã–∑—ã–≤–∞–µ–º –Ω–∞—à—É —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ø–æ–≥–æ–¥—ã

`weather.js`

```JS
const initCLI = () => {
	const args = getArgs(process.argv);

	if (args.h) {
		printHelp();
	}

	if (args.s) {
		// —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≥–æ—Ä–æ–¥
	}

	if (args.t) {
		return saveToken(args.t);
	}

	// –≤—ã–∑–æ–≤–µ–º –º–µ—Ç–æ–¥ –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –æ –ø–æ–≥–æ–¥–µ
	getWeather("moscow");
};
```

–¢—É—Ç –º–æ–∂–Ω–æ —É–≤–∏–¥–µ—Ç—å –Ω–µ—Ä–∞—Å–ø–∞—Ä—à–µ–Ω—ã–π —Ç–µ–∫—Å—Ç –æ—Ç–≤–µ—Ç–∞ –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞

![](_png/12715c0f4cb4db307969f396b190d9ef.png)

–î–∞–ª–µ–µ —Ä–µ–∞–ª–∏–∑—É–µ–º —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –Ω–∞—à–µ–≥–æ —Å–µ—Ä–≤–∏—Å–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö —Å –ø–æ–º–æ—â—å—é –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ `axios`. –ì–ª–∞–≤–Ω—ã–º –µ–≥–æ –ø—Ä–µ–π–º—É—â–µ—Å—Ç–≤–æ–º —è–≤–ª—è–µ—Ç—Å—è —Ç–æ, —á—Ç–æ –º—ã –º–æ–∂–µ–º –≤–≤–µ—Å—Ç–∏ –æ—á–µ–Ω—å –±—ã—Å—Ç—Ä–æ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã, –∫–æ—Ç–æ—Ä—ã–µ —Å—Ñ–æ—Ä–º–∏—Ä—É—é—Ç –Ω–∞—à—É —Å—Å—ã–ª–∫—É –∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–ø—Ä–æ—Å –Ω–∞ —Å–µ—Ä–≤–µ—Ä

```JS
// –ø–æ–¥–∫–ª—é—á–∞–µ–º –º–æ–¥—É–ª—å –ø–æ —Ä–∞–±–æ—Ç–µ —Å —Å—Å—ã–ª–∫–∞–º–∏
import axios from "axios";
import https from "https";
import { getKeyValue, TOKEN_DICTIONARY } from "./storage.service.js";

const getWeather = async (city) => {
	// –ø–æ–ª—É—á–∞–µ–º –∏–∑ –Ω–∞—à–µ–≥–æ —Å–ª–æ–≤–∞—Ä—è —Ç–æ–∫–µ–Ω
	const token = await getKeyValue(TOKEN_DICTIONARY.token);
	if (!token) {
		throw new Error(
			"–¢–æ–∫–µ–Ω –Ω–µ –∑–∞–¥–∞–Ω! –ó–∞–¥–∞–π—Ç–µ –µ–≥–æ —á–µ—Ä–µ–∑ –∫–æ–º–∞–Ω–¥—É -t [API_KEY]"
		);
	}

	// —Ç–∞–∫ –∂–µ –º—ã –º–æ–∂–µ–º –≤–æ—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –±–∏–±–ª–∏–æ—Ç–µ–∫–æ–π axios, —á—Ç–æ–±—ã —Å–æ–≤–µ—Ä—à–∏—Ç—å –±—ã—Å—Ç—Ä—ã–π –∑–∞–ø—Ä–æ—Å –∫ –Ω–∞—à–µ–º—É —Å–µ—Ä–≤–µ—Ä—É –Ω–∞ –ø–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
	const { data } = await axios.get(
		"https://api.openweathermap.org/data/2.5/weather",
		{
			params: {
				q: city,
				appid: token,
				lang: "ru",
				units: "metric",
			},
		}
	);

	console.log(data); // –Ω–∞–¥–æ –±—É–¥–µ—Ç —É–¥–∞–ª–∏—Ç—å —ç—Ç—É —Å—Ç—Ä–æ–∫—É - –æ–Ω–∞ –¥–ª—è –ø—Ä–∏–º–µ—Ä–∞
	return data;
};

export { getWeather };
```

–ù–∞ –≤—ã—Ö–æ–¥–µ –º—ã –ø–æ–ª—É—á–∏–º —É–∂–µ –≥–æ—Ç–æ–≤—ã–π JSON-—Ñ–∞–π–ª

![](_png/e5d277d796604c54b500eeb395a54ba3.png)

## 040 –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è - —ç—Ç–æ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ, –∫ –∫–æ—Ç–æ—Ä–æ–º –º—ã –º–æ–∂–µ–º –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –≤–æ –≤—Ä–µ–º—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏–∑ –ª—é–±–æ–π —á–∞—Å—Ç–∏ –ø—Ä–æ–≥—Ä–∞–º–º—ã. –û–Ω–∏ –º–æ–≥—É—Ç –æ—á–µ–Ω—å —Å–∏–ª—å–Ω–æ –ø–æ–º–æ—á—å, –Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–∞–±–æ—Ç—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ —Ä–∞–∑–Ω—ã—Ö —Ä–µ–∂–∏–º–∞—Ö —Ä–∞–±–æ—Ç—ã (—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞/–ø—Ä–æ–¥–∞–∫—à) –∏–ª–∏ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≥–ª–æ–±–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (–Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞ –∏ –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏ –µ–≥–æ)

```JS
console.log(process.env);
```

![](_png/2a2bf469c5f67cdd679d281f6d0e4272.png)

–ò —Ç—É—Ç —É –Ω–∞—Å –ø—Ä–∏–º–µ—Ä, —á—Ç–æ –º—ã –º–æ–∂–µ–º –∑–∞–¥–∞—Ç—å —Å–≤–æ–π —Ç–æ–∫–µ–Ω –∏ –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –µ–≥–æ –≤ –ª—é–±–æ–π –º–æ–º–µ–Ω—Ç. –í –¥—Ä—É–≥–æ–π —á–∞—Å—Ç–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –º—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º –ª–∏–±–æ —Ç–æ–∫–µ–Ω –∏–∑ –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è, –µ—Å–ª–∏ –æ–Ω –∏–º–µ–µ—Ç—Å—è, –ª–∏–±–æ –ø–æ–ª—É—á–∞–µ–º —Ç–æ–∫–µ–Ω —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–º –ø—É—Ç—ë–º

```JS
// weather.js
process.env.TOKEN = "73c01bc1e6a6771ddfdf3b7402beb7a1";

// api.service.js
const token = process.env.TOKEN ?? await getKeyValue(TOKEN_DICTIONARY.token);
```

![](_png/724cbc0dd63e3f4b0b83058d03b50775.png)

## 041 –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

–ò–∑–Ω–∞—á–∞–ª—å–Ω–æ –º—ã –∏–º–µ–µ–º –¥–≤–µ —è–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –æ—à–∏–±–∫–∏: –Ω–µ–≤–µ—Ä–Ω—ã–π –≥–æ—Ä–æ–¥ - `401`, –Ω–µ–≤–µ—Ä–Ω—ã–π —Ç–æ–∫–µ–Ω - `404`

–î–ª—è –Ω–∞—á–∞–ª–∞, –Ω—É–∂–Ω–æ –≤—ã–Ω–µ—Å—Ç–∏ –≤—ã–∑–æ–≤ —Å–∞–º–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –≤ –¥—Ä—É–≥—É—é —Ñ—É–Ω–∫—Ü–∏—é, –∫–æ—Ç–æ—Ä–∞—è —É–∂–µ –±—É–¥–µ—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å ==—Å–ø–µ—Ü–∏—Ñ–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏==, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å —á–µ—Ä–µ–∑ `axios`

`weather.js`

```JS
const getForecast = async () => {
	const weather = await getWeather("moscow");
	console.log(weather);
};

const initCLI = () => {
	const args = getArgs(process.argv);

	// console.log(process.env.TOKEN);

	if (args.h) {
		printHelp();
	}

	if (args.s) {
		// —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≥–æ—Ä–æ–¥
	}

	if (args.t) {
		return saveToken(args.t);
	}

	// –≤—ã–∑–æ–≤–µ–º –º–µ—Ç–æ–¥ –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –æ –ø–æ–≥–æ–¥–µ
	getForecast();
};

initCLI();
```

![](_png/805d0dd77d6a96f98f49651f4ef91f9a.png)

–ò —Å–µ–π—á–∞—Å –º—ã –º–æ–∂–µ–º –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ —É –Ω–∞—Å –∏–¥–µ–∞–ª—å–Ω–æ –æ—Ç—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –Ω–∞—à–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –æ—à–∏–±–æ–∫. –ö–æ–¥—ã –æ—à–∏–±–æ–∫ –º—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ —Ç–µ, —á—Ç–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –Ω–∞–º `axios` - —Å–≤–æ–∏ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ

`weather.js`

```JS
process.env.TOKEN = "73c01bc1e6a6771ddfdf3b7402beb7a1";
process.env.CITY = "mosco"; // ! "moscow"

const getForecast = async () => {
	try {
		const weather = await getWeather(process.env.CITY);
		console.log(weather);
	} catch (e) {
		if (e?.response?.status === 404) {
			printError("–ù–µ–≤–µ—Ä–Ω–æ —É–∫–∞–∑–∞–Ω –≥–æ—Ä–æ–¥");
			return;
		} else if (e.response.status === 401) {
			printError("–ù–µ–≤–µ—Ä–Ω–æ —É–∫–∞–∑–∞–Ω —Ç–æ–∫–µ–Ω");
			return;
		} else {
			printError(e.message);
		}
	}
};
```

![](_png/61e5e1e9ee4934ef68144296d3c4e8bd.png)

## 042 –£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ - –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

–î–∞–ª–µ–µ –Ω–∞–º –Ω—É–∂–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≥–æ—Ä–æ–¥–∞ —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –Ω–∞ —Ç–æ, —á—Ç–æ –≥–æ—Ä–æ–¥ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –≤–≤–µ–¥—ë–Ω. –¢–∞–∫ –∂–µ –Ω–∞–º –Ω—É–∂–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∫—Ä–∞—Å–∏–≤—ã–π –≤—ã–≤–æ–¥ –ø–æ–≥–æ–¥—ã –≤ –∫–æ–Ω—Å–æ–ª–∏.

–í –º–æ–¥—É–ª–µ —Ä–∞–±–æ—Ç—ã —Å `api`, –±—ã–ª–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ —É—Å–ª–æ–≤–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –ø–æ –ø–æ–ª—É—á–µ–Ω–Ω—ã–º –¥–∞–Ω–Ω—ã–º –ø–æ–≥–æ–¥—ã –Ω–∞ —É–ª–∏—Ü–µ, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –Ω–∞–º —Å–∏–º–≤–æ–ª —Å –ø–æ–≥–æ–¥–æ–π (—Å–º–∞–π–ª–∏–∫)

`api.service.js`

```JS
// –ø–æ–¥–∫–ª—é—á–∞–µ–º –º–æ–¥—É–ª—å –ø–æ —Ä–∞–±–æ—Ç–µ —Å —Å—Å—ã–ª–∫–∞–º–∏
import axios from "axios";
import https from "https";
import { getKeyValue, TOKEN_DICTIONARY } from "./storage.service.js";

// –≠—Ç–æ —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø–æ–¥ –∫–∞–∂–¥—É—é –ø–æ–≥–æ–¥—É
const getIcon = (icon) => {
	switch (icon.slice(0, -1)) {
		case "01":
			return "‚òÄÔ∏è";
		case "02":
			return "üå§Ô∏è";
		case "03":
			return "‚òÅÔ∏è";
		case "04":
			return "‚òÅÔ∏è";
		case "09":
			return "üåßÔ∏è";
		case "10":
			return "üå¶Ô∏è";
		case "11":
			return "üå©Ô∏è";
		case "13":
			return "‚ùÑÔ∏è";
		case "50":
			return "üå´Ô∏è";
	}
};

const getWeather = async (city) => {
	// –ø–æ–ª—É—á–∞–µ–º –∏–∑ –Ω–∞—à–µ–≥–æ —Å–ª–æ–≤–∞—Ä—è —Ç–æ–∫–µ–Ω
	const token =
		process.env.TOKEN ?? (await getKeyValue(TOKEN_DICTIONARY.token));
	if (!token) {
		throw new Error(
			"–¢–æ–∫–µ–Ω –Ω–µ –∑–∞–¥–∞–Ω! –ó–∞–¥–∞–π—Ç–µ –µ–≥–æ —á–µ—Ä–µ–∑ –∫–æ–º–∞–Ω–¥—É -t [API_KEY]"
		);
	}

	// —Ç–∞–∫ –∂–µ –º—ã –º–æ–∂–µ–º –≤–æ—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –±–∏–±–ª–∏–æ—Ç–µ–∫–æ–π axios, —á—Ç–æ–±—ã —Å–æ–≤–µ—Ä—à–∏—Ç—å –±—ã—Å—Ç—Ä—ã–π –∑–∞–ø—Ä–æ—Å –∫ –Ω–∞—à–µ–º—É —Å–µ—Ä–≤–µ—Ä—É –Ω–∞ –ø–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
	const { data } = await axios.get(
		"https://api.openweathermap.org/data/2.5/weather",
		{
			params: {
				q: city,
				appid: token,
				lang: "ru",
				units: "metric",
			},
		}
	);
	return data;
};

export { getWeather, getIcon };
```

–í –ª–æ–≥–µ –±—ã–ª–∞ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `printWeather`, –∫–æ—Ç–æ—Ä–∞—è –≤—ã–≤–æ–¥–∏—Ç –Ω–∞–º –¥–∞–Ω–Ω—ã–µ –æ –ø–æ–≥–æ–¥–µ

`log.service.js`

```JS
// —ç—Ç–∞ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –∫—Ä–∞—Å–∏—Ç –≤—ã–≤–æ–¥—ã —Ç–µ–∫—Å—Ç–∞
import chalk from "chalk";
// —ç—Ç–∞ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ —É–¥–∞–ª—è–µ—Ç —Ç–∞–±—É–ª—è—Ü–∏—é –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ –∫–æ—Å—ã—Ö –∫–∞–≤—ã—á–µ–∫
import dedent from "dedent-js";

// –≤—ã–≤–æ–¥–∏–º –æ—à–∏–±–∫—É
const printError = (error) => {
	console.log(`${chalk.bgRed(" ERROR")} ${error}`);
};

// –æ–ø–æ–≤–µ—â–∞–µ–º –æ–± —É—Å–ø–µ—Ö–µ
const printSuccess = (success) => {
	console.log(`${chalk.bgGreen(" Success")} ${success}`);
};

// –≤—ã–≤–æ–¥–∏–º –ø–æ–º–æ—â—å
const printHelp = () => {
	console.log(
		dedent`
			${chalk.bgCyan(" HELP ")}
			–ë–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ - –≤—ã–≤–æ–¥ –ø–æ–≥–æ–¥—ã
			-s [CITY] –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –≥–æ—Ä–æ–¥–∞
			-t [API_KEY] –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —Ç–æ–∫–µ–Ω–∞
			-h –¥–ª—è –ø–æ–∫–∞–∑–∞ –ø–æ–º–æ—â–∏
		`
	);
};

const printWeather = (res, icon) => {
	console.log(
		dedent`
			${chalk.bgMagenta(" –ü–û–ì–û–î–ê ")} –ø–æ–≥–æ–¥–∞ –≤ –≥–æ—Ä–æ–¥–µ ${res.name}
			${icon}  ${res.weather[0].description}
			–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞: ${Math.round(res.main.temp)}
			–ß—É–≤—Å—Ç–≤—É–µ—Ç—Å—è –∫–∞–∫: ${Math.round(res.main.feels_like)}
			–í–ª–∞–∂–Ω–æ—Å—Ç—å: ${res.main.humidity}%
			–°–∫–æ—Ä–æ—Å—Ç—å –≤–µ—Ç—Ä–∞: ${Math.round(res.wind.speed)} –º/—Å
			`
	);
};

export { printError, printSuccess, printHelp, printWeather };
```

–ò —É–∂–µ —Ç—É—Ç –±—ã–ª –¥–æ—Ä–∞–±–æ—Ç–∞–Ω –≤—ã–≤–æ–¥ –¥–∞–Ω–Ω—ã—Ö –∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `saveCity`, –∫–æ—Ç–æ—Ä–∞—è —Å–æ—Ö—Ä–∞–Ω—è–ª–∞ –≥–æ—Ä–æ–¥

`weather.js`

```JS
#!/usr/bin/env node
import { getArgs } from "./helpers/args.js";
import { getWeather, getIcon } from "./services/api.service.js";
import {
	printHelp,
	printError,
	printSuccess,
	printWeather,
} from "./services/log.service.js";
import {
	saveKeyValue,
	getKeyValue,
	TOKEN_DICTIONARY,
} from "./services/storage.service.js";

process.env.TOKEN = "73c01bc1e6a6771ddfdf3b7402beb7a1";
process.env.CITY = "moscow";

// —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –æ–ø–µ—Ä–∞—Ü–∏–∏
const saveToken = async (token) => {
	// –ø—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —Ç–æ–∫–µ–Ω–∞
	if (!token.length) {
		printError("–ù–µ –ø–µ—Ä–µ–¥–∞–Ω —Ç–æ–∫–µ–Ω");
		return;
	}

	// —Å–∞–º–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
	try {
		await saveKeyValue(TOKEN_DICTIONARY.token, token);
		printSuccess("–¢–æ–∫–µ–Ω —Å–æ—Ö—Ä–∞–Ω—ë–Ω");
	} catch (e) {
		printError("–¢–æ–∫–µ–Ω –Ω–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å :( " + e.message);
	}
};

// —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –æ–ø–µ—Ä–∞—Ü–∏–∏
const saveCity = async (city) => {
	// –ø—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —Ç–æ–∫–µ–Ω–∞
	if (!city.length) {
		printError("–ù–µ –ø–µ—Ä–µ–¥–∞–Ω –≥–æ—Ä–æ–¥");
		return;
	}

	// —Å–∞–º–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
	try {
		await saveKeyValue(TOKEN_DICTIONARY.city, city);
		printSuccess("–ì–æ—Ä–æ–¥ —Å–æ—Ö—Ä–∞–Ω—ë–Ω");
	} catch (e) {
		printError("–ì–æ—Ä–æ–¥ –Ω–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å " + e.message);
	}
};

const getForecast = async () => {
	try {
		const city = process.env.CITY ?? getKeyValue(TOKEN_DICTIONARY.city);
		// –ø–æ–ª—É—á–∞–µ–º –ø–æ–≥–æ–¥—É
		const weather = await getWeather(city);
		// –≤—ã–≤–æ–¥–∏–º –ø–æ–≥–æ–¥—É –≤ –∫–æ–Ω—Å–æ–ª—å
		printWeather(weather, getIcon(weather.weather[0].icon));
	} catch (e) {
		// –µ—Å–ª–∏ –º—ã –Ω–µ –ø–æ–ª—É—á–∏–ª–∏ –≥–æ—Ä–æ–¥, —Ç–æ –ø–æ–ª—É—á–∏–º –æ—à–∏–±–∫—É
		if (e?.response?.status === 404) {
			printError("–ù–µ–≤–µ—Ä–Ω–æ —É–∫–∞–∑–∞–Ω –≥–æ—Ä–æ–¥");
			return;
			// –µ—Å–ª–∏ –º—ã –Ω–µ –ø–æ–ª—É—á–∏–ª–∏ –≥–æ—Ä–æ–¥, —Ç–æ –ø–æ–ª—É—á–∏–º –æ—à–∏–±–∫—É
		} else if (e.response.status === 401) {
			printError("–ù–µ–≤–µ—Ä–Ω–æ —É–∫–∞–∑–∞–Ω —Ç–æ–∫–µ–Ω");
			return;
			// –∏ –≤ –æ—Å—Ç–∞–ª—å–Ω—ã—Ö —Å–ª—É—á–∞—è—Ö –ø—Ä–æ—Å—Ç–æ –ø–æ–ª—É—á–∏–º –æ—à–∏–±–∫—É
		} else {
			printError(e.message);
		}
	}
};

const initCLI = () => {
	const args = getArgs(process.argv);

	// console.log(process.env.TOKEN);

	if (args.h) {
		// –≤—ã–≤–æ–¥ –ø–æ–º–æ—â–∏
		return printHelp();
	}

	if (args.s) {
		// —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≥–æ—Ä–æ–¥
		return saveCity(args.s);
	}

	if (args.t) {
		// —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞
		return saveToken(args.t);
	}

	// –≤—ã–∑–æ–≤–µ–º –º–µ—Ç–æ–¥ –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –æ –ø–æ–≥–æ–¥–µ
	return getForecast();
};

initCLI();
```

![](_png/4043d875ed16b42f678ef8cc1e081708.png)

## 043 –ü—É–±–ª–∏–∫–∞—Ü–∏—è –ø–∞–∫–µ—Ç–∞ –≤ NPM

–ò —Ç–µ–ø–µ—Ä—å –º—ã –º–æ–∂–µ–º –æ–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å, —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å —É —Å–µ–±—è –Ω–∞ –∫–æ–º–ø—å—é—Ç–µ—Ä–µ –Ω–∞—à—É —É—Ç–∏–ª–∏—Ç—É

```bash
npm publish

npm i -g zeizel-weather-cli

weather
```

![](_png/f0fefb5972615b06c367388937f7c49e.png)

![](_png/e92a6c36a26b3a8d06c01e80ec5979c0.png)

–¢–∞–∫ –∂–µ —É –Ω–∞—Å –µ—Å—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Å–∫—Ä–∏–ø—Ç—ã, –Ω–∞—á–∏–Ω–∞—é—â–∏–µ—Å—è –Ω–∞ `pre-`, –∫–æ—Ç–æ—Ä—ã–µ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –¥–æ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–≥–æ –¥–µ–π—Å—Ç–≤–∏—è. –ö–æ–Ω–∫—Ä–µ—Ç–Ω–æ –º—ã –º–æ–∂–µ–º –∑–∞–ø–∏—Å–∞—Ç—å `prepare` —Å–∫—Ä–∏–ø—Ç, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è –¥–æ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –ø–∞–∫–µ—Ç–∞ –Ω–∞ npm

```JSON
"scripts": {
    "prepare": "tsc",
    "test": "echo \"Error: no test specified\" && exit 1"
  },
```

## 044 Npx –∏ npm exec

–ö–æ–º–∞–Ω–¥–∞ `"start"` —Ö—Ä–∞–Ω–∏—Ç –≤ —Å–µ–±–µ –±—ã—Å—Ç—Ä—ã–π –∑–∞–ø—É—Å–∫ –Ω–∞—à–µ–π —É—Ç–∏–ª–∏—Ç—ã

```JSON
"scripts": {
    "prepare": "tsc",
    "start": "node weather.js",
    "test": "echo \"Error: no test specified\" && exit 1"
  },
```

–ò —Ç—É—Ç —Å—Ç–æ–∏—Ç —É–∫–∞–∑–∞—Ç—å –ø–µ—Ä–≤–æ–µ —É—Ç–æ—á–Ω–µ–Ω–∏–µ. –ï—Å–ª–∏ –º—ã –±—É–¥–µ–º —Å —Ç–∞–∫—É—é –∑–∞–ø–∏—Å—å –ø—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã, —Ç–æ —ç—Ç–æ –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–µ—Ç, —Ç–∞–∫ –∫–∞–∫ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –±—É–¥—É—Ç –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å—Å—è –Ω–µ–ø–æ—Å—Ä–µ–¥—Å—Ç–≤–µ–Ω–Ω–æ npm-–ø–∞–∫–µ—Ç—É. –ß—Ç–æ–±—ã –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–µ—Ä–µ–¥–∞–≤–∞–ª–∏—Å—å –Ω–∞—à–µ–π –∫–æ–º–∞–Ω–¥–µ, –∫–æ—Ç–æ—Ä–∞—è –∑–∞–ø–∏—Å–∞–Ω–∞ –≤ `"start"`, –Ω—É–∂–Ω–æ –∏—Ö –∑–∞–ø–∏—Å—ã–≤–∞—Ç—å –ø–æ—Å–ª–µ `--`

```bash
// —Ç–∞–∫–æ–π –∫–æ–¥ –Ω–µ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å
npm start -s moscow

// —Å–µ–π—á–∞—Å –æ—Ç—Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ
npm start -- -s moscow
```

–¢–∞–∫ –∂–µ —É –Ω–∞—Å –µ—Å—Ç—å –∫–æ–º–∞–Ω–¥–∞ `npm exec` –∏–ª–∏ `npx`. –û–Ω–∞ –ø–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–ø—É—Å–∫–∞—Ç—å –∫–∞–∫–∏–µ-–ª–∏–±–æ –ø–∞–∫–µ—Ç—ã –≤ –Ω–∞—à–µ–º –ø—Ä–æ–µ–∫—Ç–µ –±–µ–∑ –≤–Ω–µ–¥—Ä–µ–Ω–∏—è –≤ –Ω–µ–≥–æ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

–í –ø—Ä–∏–º–µ—Ä–µ —É –Ω–∞—Å –ø–∞–∫–µ—Ç —Å–∫–∞—á–∞–µ—Ç—Å—è –≤ –∫–µ—à –∏ –±—É–¥–µ—Ç –∑–∞–ø—É—Å–∫–∞—Ç—å—Å—è –∏–∑ –Ω–µ–≥–æ, –Ω–æ –Ω–µ –±—É–¥–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ –ø—Ä–æ–µ–∫—Ç –≤ –∫–∞—á–µ—Å—Ç–≤–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π. –¢–∞–∫ –∂–µ –∑–¥–µ—Å—å –º–æ–∂–Ω–æ –±—É–¥–µ—Ç –ø–µ—Ä–µ–¥–∞—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –Ω–µ–ø–æ—Å—Ä–µ–¥—Å—Ç–≤–µ–Ω–Ω–æ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –±–µ–∑ `--`

```bash
// —É–¥–∞–ª–∏–º –Ω–∞—à –ø–∞–∫–µ—Ç
npm uni -g zeizel-weather-cli

// –∏ –¥–∞–ª–µ–µ –ø—Ä–æ—Å—Ç–æ –∑–∞–ø—É—Å—Ç–∏–º –Ω–∞—à –ø–∞–∫–µ—Ç
npx zeizel-weather-cli -s mosow
```
