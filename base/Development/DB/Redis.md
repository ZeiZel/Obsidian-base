#Redis #DataBase #Cache

## Что такое Redis?

==Redis== - это база данных, которая хранит все свои данные в виде `ключ: значение`, но при этом не использует ни документный подход, как в ==MongoDB==, ни объектный подход, как в ==SQL== 

![](../_png/39ad45b25a8e1ce2e6f9d067259dc179.png)

Redis, в отличие от других баз данных, не хранит свои данные на диске - он держит их в оперативной памяти. За счёт такого подхода он работает в разы более быстро, чем другие БД. Однако эти данные энергозависимы, и, если компьютер отключится, то все заполненные данные пропадут. Из-за этого Redis больше подходит для сохранения информации в виде кеша.

В Редисе мы можем хранить результаты выполнения определённых вычислений, которые долго считать заново.

Скорость получения информации из ОЗУ может занимать до нескольких миллисекунд, что в разы быстрее, чем при работе с полноценными БД, которые ищут и отдают информацию с диска.

## Установка Redis

Для установки Redis потребуется Mac или Linux. Конкретно для Windows потребуется подсистема WSL, в которой нужно выполнить данную команду:

```bash
sudo apt-get install redis
```

И потом нужно ввести пароль от своей учётной записи виртуальной Linux

Сейчас остаётся только запустить сервер редиса:

```bash
redis-server

// или таким способом: 

sudo service redis-server start
```

![](../_png/112082197c4d4bf78f44a7973d0bd429.png)

Чтобы отключить сервер, можно воспользоваться командой `shutdown`

```bash
redis-cli shutdown NOSAVE

// или...

sudo service redis-server stop
```

Далее открываем второй терминал WSL и переходим к CLI Редиса:

```bash
redis-cli
```

## Базовые команды Redis

После открытия CLI редиса можно начать ввод нужных нам данных. Самое первое, что мы можем сделать - записать `SET` значение `Valery` в ключ `name`

![|400](../_png/ab122509163e37d7a1352e91781b148c.png)

И далее через `GET` можно получить нужное значение

![|400](../_png/6669565088831c7ec93b4db1b6cc628e.png)

Так же мы можем удалить запись через `DEL`. Тут мы можем увидеть, что ==Redis== понимает, что конкретно в данном случае мы работали с числом (которое хранилось в базе в виде строки).

После попытки получить значение, мы видим, что на выходе будет нулевое значение

![|400](../_png/ad8f2d84447938780f10bf2197476cd3.png)

Через `Exists` можно проверить наличие ключа (0 или 1)

![|400](../_png/d894daea3cec64463edc08b70efb3ae4.png)

Используя `KEYS` мы можем вывести по определённому паттерну нужные нам ключи. Чтобы вывести все ключи, нужно воспользоваться паттерном `*`

![|400](../_png/1ce22deb0bae2aab22b60f4fa1c41a0b.png)

Если воспользоваться командой `flushall`, то она очистит весь кеш (все данные)

![|400](../_png/59229029f7bc027effbb408647430b2a.png)

И так же мы можем очистить консоль, когда логов стало слишком много

```bash
clear
```

## Handling Expirations

Команда `TTL` позволяет нам получить время жизни определённого ключа. Если он возвращает `-1`, то время жизни объекта не ограничено

![](../_png/0c779fb195edd3e238e0af254d988fbb.png)

Чтобы указать время жизни ключа, можно воспользоваться командой `EXPIRE ключ время` и `ttl` нам будет показывать отсчёт времени существования ключа. Когда `ttl` покажет `-2`, то объект уже будет уничтожен

![](../_png/bab34f8e41ae3b9cb13a84a38ee2a6c5.png)

Так же командой `SETEX` мы можем сразу указать время жизни ключа

![](../_png/aaedd6b65d27f3d43dfa4c0cfdd4e808.png)

## Lists

Так же Redis имеет подобие массивов в виде списков. 

Команда `lpush имя_списка значение` добавляет запись в начало списка (список создаётся или выбирается при первом добавлении значения), а команда `rpush` добавляет запись в конец списка. 

Команда `lrange список откуда докуда` позволяет вывести нужные значения списка. Если конечным элементом выбрать `-1`, то выведется весь список.

![](../_png/592288a31e12667d3bf6501881d49317.png)

Команда `LPOP` удалит значение из начала списка, а `RPOP` из конца списка

![](../_png/fe3c95cc3b0f57820dce23a87ca7d5eb.png)

## Sets

Так же в ==Redis== есть подобие массивов, состоящих только из уникальных значений, как в ==JS==. 

Команда `SADD` позволяет добавить новое значение в список. Если повторно воспользоваться командой с тем же значением, то мы получим `0`, так как подобный список не даёт добавить повторяющиеся значения. `SMEMBERS имя_списка` позволяет вывести все значения списка.

![](../_png/c19400c808c4045efa571ab9cb5dd236.png)

Команда `SREM` позволяет очистить список полностью 

![](../_png/84521a1af51852dc91ad54d0c7c14ced.png)

## Hashes

==Хэши Redis== - это типы записей, структурированные как коллекции пар поле-значение. Использовать хэши, среди прочего, для представления базовых объектов и хранения групп счетчиков.

- `HSET` - установка значения в хеш 
- `HGETALL` - получить все значения из хеша
- `HDEL` - удалить определённое значение из хеша
- `HEXISTS` - проверить существование ключа в хеше

![](../_png/0f1a2c7c29a65eda5468abeb96d25d71.png)