#Ansible

Ansible - это утилита для автоматиизации выполнения скриптов.

## Задачи Ansible

Для чего нам нужно его использовать:

1. **Автоматиизирует повторяющиеся задачи**. Сразу позволяет выполнить все нужные операции на большом количестве машин.
2. **Автоматизирует сложные задачи**. Позволяет повторять сложные задачи раз за разом без совершения определённых ошибок.
3. **Поддерживает IAC концепцию** (инфраструктура как код).

Какие задачи он решает:

1. Отметает человеческий фактор при исполнении скриптов.
2. Решает проблему недостатка прозрачности настроек и документации
3. Устраняет сложность повторения определённой операции
4. Экономит кучу времени
5. Повышает переносимость решения

Какие плюсы именно Ansible:

1. Нет доп ПО на сервере - только python
2. Можно легко дописывать свои модули
3. Низкий порог вхождения
4. Возможность интеграции API через AWX (через который можно настроить автоматическое выполнение скриптов и scheduling)

## Схема работы Ansible

1. **YML-конфиг** (то, что мы выполняем). Описывает то состояние, к которому нам нужно привести сервера. Тут мы описываем последовательно состояние, к которому мы должны привести систему.
2. **Инвентарь** (на чём выполняем). Это модуль. Описывает все сервера, их состояния, как к ним подключаться, под какими пользователями выполнять операции, ip и переменные.
3. **Ansible**. Он уже приводит сервера к описанному ранее состоянию.
	1. Первым делом, он собирает **факты о серверах**. Подключается / не подключается, тип ОС, прпоисходит первичный коннект.
	2. **Сборка конфигов с серверов**.
	3. Подключение плагинов
	4. Подключение модулей
4. **Транспиляция YAML в python и исполнение кода**. Все конфигурации разбираются на одной хостовой машине в самом Ansible.

![](_png/Pasted%20image%2020250104234939.png)

Системы автоматизации обычно делятся на pull и push. Pull требуют наличия агента на серверах, чтобы проверять изменения и подтягивают исполняемый конфиг сами в себя. Push уже требуют, чтобы мы зсами запихнули конфиг на сервер, чтобы тот выполнился. Второй вариант является более удобным, так как не требует на сервере никакого дополнительного ПО и агентов. 

Когда мы используем Ansible на том же Ubuntu сервере (на котором уже есть python) нам не нужно ничего устанавливать кроме ssh, который позволит исполнять нам удалённо скрипты.

Модули и плагины - это подключаемые к Ansible куски кода. 
Сами отличия:

| Модули                      | Плагины                    |
| --------------------------- | -------------------------- |
| Выполняются на клиентах     | Выполняются на host-машине |
| Выполняются при подключении | Выполняются до подключения |

## Установка

Через любой пакетный мендежер (включая `pip`)

```bash
brew install ansible

# Или

sudo [apt|dnf|pacman] install ansible
```

## Inventory

Инвентарь - это описание всех хостов и серверов, на которых будут исполняться команды Ansible и playbooks.

Написать конфиг инвентаря можно с помощью менее многословного `.ini` либо через `.yml`

Когда мы указываем домены `[group]` в квадратных скобках, то мы можем исполнять скрипты на целых группах доменов. Такие группы можно, например, использовать для установки nginx на множество серверов.

![](_png/Pasted%20image%2020250105111959.png)

Так же мы можем:
1. Если у машины есть порядковые номера, то можно указать период
2. Можем использовать определённые переменные
3. Так же можно для сервера без названия указать алиас, к которому будет удобно обращаться (так на третьем примере сервер будет называться `coolhost`, а не `192.68...`)

![](_png/Pasted%20image%2020250105112523.png)

4. Так же можно спокойно указать переменные для группы через `[group:vars]`

![](_png/Pasted%20image%2020250105113053.png)

Параметры подключения к хосту состоят из 4ёх блоков:
1. Параметры подключения
2. Параметры ssh / scp / sftp
3. Привилегии
4. Настройки shell

![](_png/Pasted%20image%2020250105113153.png)

3:00





## Modules










## Ad-hoc
















