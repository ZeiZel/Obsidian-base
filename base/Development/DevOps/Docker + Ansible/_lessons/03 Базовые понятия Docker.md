
## 002 Архитектура Docker

Докер и виртуальная машина - это две разные вещи. Докер не использует супервизоры и не поднимает полноценную гостевую ОС, чтобы поднять внутри неё контейнезированное приложение.

![](_png/c3930d6ff8e7dc7d513a0d05315ef34d.png)

`htop` позволяет просмотреть процессы в linux и управлять ими

![](_png/165857ab81a7ea6a27d1831a2dfdccf3.png)

При запуске процесса внутри docker, мы запускаем новый namespace, который в себя включается 
- Cgroups - определяет ограничения по памяти и ресурсам процессора
- IPC - определяет коммуникацию между процессами
- Network
- Mount - определяет доступность директорий
- PID - свои Process ID
- User 
- UTS

Контейнер докера - это изолированный namespace с обвязками докера, который запускается на хостовой машине

![](_png/af5df03da3fe9c0d48604ffb34a0741c.png)

>[!info] Docker использует ядро Linux хоста и image содержит только необходимые бинарные файлы, библиотеки и приложения

Докер делится на две части: клиентская часть CLI и хостовая, которая принимает запросы от CLI и выполняет нужные команды

![](_png/5adf973d976449f68eda60be1017dede.png)

На клиенте мы отправляем команды в докер по API, который отправляет запрос в докер daemon. Daemon проверяет, есть ли нужный образ локально. Если образ отсутствует, то он обращается в общий registry и подтягивает образ оттуда и потом запускает контейнер

![](_png/09b0f94f48e7a6c43c03b732d622e4d8.png)

## 003 Управление контейнерами

Для упрощения работы с контейнерами их команды были вынесены наверх

вместо
```bash
docker container start
docker container stop
docker container stats
```

мы можем писать
```bash
docker start
docker stop
docker stats
```

![](_png/ffeb485c3c5f471e83c434323a4dae31.png)

У нас есть достаточное количество команд для контроля ЖЦ контейнера:
- `docker run` - создаст контейнер и запустит его
- `docker create` - создаст контейнер в остановленном виде
- `docker kill / stop` - останавливает работу контейнера
- `docker rm` - удалит контейнер (`--force` убьёт и удалит запущенный контейнер)

![](_png/9f1dc2392bb09a513c2c02b3fafd0013.png)

Первая команда показывает запущенные контейнеры. Ключ `-a` покажет все контейнеры, включая остановленные

```bash
docker ps 
docker ps -a
```

![](_png/153503db363705e2c6b9014fe315c6ca.png)

Удаление контейнера

```bash
docker rm имя/id 
```

Создаём контейнер из образа `mongo`, который будет с указанными именем `my-mongo`. Флаг `-d` позволяет отцепить процесс от текущего bash и запустить его в отдельной сессии

```bash
docker run --name my-mongo -d mongo
```

Когда мы пользуемся определённой сменой состояния процесса, мы посылаем сигнал 

![](_png/c5d14a348289e846e93a03cc590d02ba.png)

Удаляет все остановленные контейнеры

```bash
docker container prune
```

Переименование контейнера

```bash
docker rename имя_контейнера новое_имя
```

## 004 Логи и статистика работы

Показывает всю статистику занимаемого пространства и ресурсов по контейнерам

```bash
docker stats
```

Показывает всю информацию по нужному контейнеру

```bash
docker inspect имя_контейнера

// покажет, включая занимаемое место
docker inspect -s имя_контейнера 

// покажет, одно отдельное свойство
docker inspect -f "{{.Status.State}}" имя_контейнера
```

Позволит вывести логи контейнера

```bash
docker logs контейнер
```

## 005 Команды в контейнере

Докер нам так же предоставляет возможность запускать команды внутри 

![](_png/78d08b3154ece4839d01c071fb4b1e3a.png)

позволяет установить и просмотреть локальные переменные

```bash
docker exec -e MYVAR=1 mongo printenv
```

![](_png/9de10fb84546c9bf1db7c45664c92930.png)

А тут мы уже залезли внутрь контейнера и можем выполнять различные операции над ним

```bash
docker exec -it mongo bash
```

![](_png/a156947a52ff6b8e4001da1631e975a8.png)

Так же мы можем вывод из консоли вывести в отдельный файл, если нам потребуется

Тут сразу нужно сказать, что команда вывода и сохранения в новый файл происходит вне контейнера

![](_png/9a1347dfb33a65f4ad9edd94a40d5c40.png)

Если нужно запустить команду внутри контейнера, то можно сделать таким образом:

```bash
docker exec mongo bash -c 'mongo --version > mongo.txt'
```
